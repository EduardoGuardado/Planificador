# PlanificadorDesarrollo de un sistema web para la creación y control de las planificaciones docentes## Mapa de la carpeta del proyecto[poner aquí el archivo generado para mostrar el árbol de directorios]### Base de datosMostramos las tablas utilizadas dentro de las base de datos:* roles* usuarios* grados* materias* materiasniveles* unidades* contenidos* asignaciones* planificaciones* plandetalles* recursos## Carpeta \application## views* comun* errors* inicio* perfiles* roles* profesores### inicio#### index.php:Este archivo es una sola vista de la página principal para iniciar sesión, por lo cual no depende de los archivos **header** y **footer** contenido en la carpeta **comun**.Estilos personalizados:<pre><code>línea 47:<br>&lt;style&gt; .estilos{} &lt;/style&gt;</code></pre><br>>[!NOTE]>>En la sección de **estilos** puedes agregar tus propios estilos para mejorar la vista.<br>Vista del **Login**:<pre><code>línea 110:<br>&lt;div class="container"&gt;	&lt;!-- VISTA LOGIN --&gt;	&lt;div class="row"&gt;            &lt;div class="col-12" id="divTabla"&gt;                &lt;?php $this->load->view('inicio/login'); ?&gt;            &lt;/div&gt;        &lt;/div&gt;&lt;/div&gt;</code></pre><hr>#### login.php:Este archivo contiene el formulario que nos permitirá ingresar los datos de inicio de sesión para acceder a nuestro panel de control mostrando diferentes elementos dependiendo de nuestro nivel de acceso (rol).Estructura del formulario con los estilos de **Grid** utilizados en *Bootstrap*:<pre><code>línea 1:<br>&lt;div class="row justify-content-md-center" style="padding-top: 10em;"&gt; ... &lt;/div&gt;</code></pre><br>El atributo **action** contiene la ruta hacia la función que nos permitirá iniciar sesión:<pre><code>línea 3:<br>&lt;form class="form" action="&lt;?php echo base_url()?&gt;index.php/InicioControlador/InicioSesion" method="post"&gt;...&lt;/form&gt;</code></pre><br>Los **input** encargados de enviar el *usuario* y *contraseña* para comprobar su validez, además de utilizar un **required** para que el usuario esté obligado a ingresar sus credenciales antes de iniciar sesión:<pre><code>línea 10:<br>&lt;input type="text" class="form-control" id="usuario" name="usuario" placeholder="Ah" required=""&gt;</code></pre><br><pre><code>línea 14:<br>&lt;input type="password" class="form-control" id="clave" name="clave" placeholder="contraseña" required=""&gt;</code></pre><hr>## controllers* InicioControlador* RolesControlador* ProfesoresControlador### InicioControlador.phpPara crear la clase de **InicioControlador** se agregan las siguientes líneas:<pre><code>línea 1 a 4:<br>&lt;?phpdefined('BASEPATH') OR exit('No direct script access allowed');class InicioControlador extends CI_Controller</code></pre><hr>#### function __construct()Dentro del constructor inicializamos las **librerías** a utilizar y las clases de los **Models** para comunicarnos con la base de datos.<pre><code>línea 8 y 9:<br>	$this->load->model("InicioModel");	$this->load->library('session');</code></pre><hr>#### function index()Cargamos la vista de inicio de sesión.<pre><code>línea 14:<br>	$this->load->view('inicio/index');</code></pre><hr>#### function InicioSesion()En esta función obtenemos los datos que se enviaron desde el formulario de inicio de sesión.<pre><code>línea 19 y 20:<br>	$usuario = $this->input->post('usuario');	$clave = $this->input->post('clave');</code></pre><br>Enviamos el usuario a buscar en la función **ListarUsuarios** del modelo **InicioModel**.<pre><code>línea 21:<br>	$datosProfesor = $this->InicioModel->ListarUsuarios($usuario);</code></pre><br>Recorremos el array de datos que obtuvimos al hacer la consulta y guardamos los datos en la variable asociada al dato que queremos obtener.<pre><code>línea 23:<br>	foreach ($datosProfesor as $p) {		$prNombre	= $p->nombre;		$prApellido	= $p->apellido;		$prUsuario	= $p->usuario;		$prRol		= $p->rol;	}</code></pre><br>Comprobamos que hemos obtenido una fila de datos de la consulta y que la contraseña del usuario es la misma que la almacenada en la base de datos.<pre><code>línea 30:<br>	if (count($datosProfesor) > 0 && password_verify($clave, $datosProfesor[0]->clave))</code></pre><br>De ser verdadero lo anterior procedemos a crear un arreglo con los datos del usuario que se almacenarán en la sesión para ser utilizados en las secciones a las que tendrá acceso y que nos permitirá conocer si hay una sesión abierta.<pre><code>línea 31:<br>	$datos = [		"nombre" 	=> $prNombre,		"apellido" 	=> $prApellido,		"usuario" 	=> $prUsuario,		"rol" 		=> $prRol,		"logged_in" => TRUE	];</code></pre><br>Y guardamos el arreglo en la sesión.<pre><code>línea 39:<br>	$this->session->set_userdata($datos);</code></pre><br>Además de redireccionar al área principal del usuario, el panel de control.<pre><code>línea 41:<br>	return redirect(base_url()."index.php/InicioControlador/PerfilUsuario",'location',302);</code></pre><br>De lo contrario, si los datos son falsos, entonces permaneceremos en la ventana de inicio de sesión.<pre><code>línea 43:<br>	return redirect(base_url(),'location',302);</code></pre><hr>#### function PerfilUsuario()En esta función cargamos los datos almacenados en la sesión.<pre><code>línea 50:<br>	$user = $this->session->userdata('usuario');</code></pre><br>Creamos dos arreglos que almacenarán los datos que buscamos del usuario que ha iniciado sesión.<pre><code>línea 51:<br>	$data['profesor'] = $this->InicioModel->ListarUsuarios($user);	$data['user'] = $user;</code></pre><br>Enviamos los datos a la vista del perfil del usuario para que sean procesados. Además, anexamos las vistas de **header** y **footer**.<pre><code>línea 54:<br>	$this->load->view('comun/header');	$this->load->view('perfiles/index', $data);	$this->load->view('comun/footer');</code></pre><hr>#### function CerrarSesion()En esta función eliminamos la sesión actual para que no se pueda acceder a los datos de la misma y que el usuario vuelva a la ventana de inicio de sesión cerrando su perfil por completo.<pre><code>línea 61:<br>	$this->session->sess_destroy();	return redirect(base_url(),'location',302);</code></pre><hr>## models* InicioModel* RolesModel* ProfesoresModel### InicioModel.phpPara crear la clase de **InicioModel** se agregan las siguientes líneas:<pre><code>línea 1 a 3:<br>&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class InicioModel extends CI_Model</code></pre><hr>Luego creamos los atributos de la clase donde almacenamos las consultas más comunes a realizar en la base de datos:<pre><code>línea 4:<br>	private $tablas 	= ' usuarios, roles ';	private $columnas 	= ' usuarios.idUsuario, usuarios.nombre, usuarios.apellido, usuarios.correo, usuarios.telefono, usuarios.usuario, usuarios.clave, roles.rol ';	private $filtrado 	= ' usuarios.idRol = roles.idRol ';	private $preciso 	= ' AND usuarios.usuario = ';</code></pre><hr>#### function ListarUsuarios($usuario)En esta función devuelve la lista de los usuarios (profesores) que se encuentran en la base de datos. Para permitir encontrar un solo usuario, por lo que recibe un parámetro.<pre><code>línea 10:<br>	$this->db->select($this->columnas)->from($this->tablas)->where($this->filtrado.$this->preciso.'"'.$usuario.'"');	return $this->db->get()->result();</code></pre><hr>